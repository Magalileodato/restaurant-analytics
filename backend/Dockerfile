# ============================================================
# üê≥ DOCKERFILE PARA BACKEND FASTAPI
# ============================================================
# Projeto: Restaurant Analytics MVP
# Desenvolvedora: Magali Leodato
# Descri√ß√£o: Container do backend FastAPI, Python 3.11,
#             com SQLAlchemy, PostgreSQL e scripts de gera√ß√£o
#             de vendas fict√≠cias.
# ============================================================

# üß© Imagem base com Python 3.11
FROM python:3.11-slim

# ============================================================
# üåê DEFINI√á√ÉO DE VARI√ÅVEIS DE AMBIENTE
# ============================================================
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

# ============================================================
# üìÇ CRIAR DIRET√ìRIO DO APP
# ============================================================
WORKDIR /app

# ============================================================
# üì¶ COPIAR ARQUIVOS DE DEPEND√äNCIAS
# ============================================================
COPY requirements.txt .

# ============================================================
# üîß INSTALAR DEPEND√äNCIAS
# ============================================================
RUN pip install --upgrade pip \
    && pip install --no-cache-dir -r requirements.txt

# ============================================================
# üìÇ COPIAR C√ìDIGO DO BACKEND
#   (o docker-compose monta ../backend -> /app, mas manter COPY
#    garante build em ambientes sem bind-mount)
# ============================================================
COPY src ./src

# (Opcional) Se quiser embutir scripts/SQL no image:
# COPY data ./data

# ============================================================
# üåê DEFINIR PORTA DE EXPOSI√á√ÉO
# ============================================================
EXPOSE 8000

# ============================================================
# üî• COMANDO PARA RODAR A API FASTAPI (sem --reload)
# ============================================================
CMD ["uvicorn", "src.main:app", "--host", "0.0.0.0", "--port", "8000"]

# ============================================================
# üí° OBSERVA√á√ïES
# ============================================================
# - Para desenvolvimento com hot-reload, use override no docker-compose:
#   command: uvicorn src.main:app --host 0.0.0.0 --port 8000 --reload
# - Em produ√ß√£o, mantenha este CMD sem --reload.
# ============================================================
